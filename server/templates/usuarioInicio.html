<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Boletin BC [v0.7]</title>

    <link href="../../static/assets/css/bootstrap.css" rel="stylesheet">
    <link href="../../static/assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- CSS for table sort icons -->
    <link rel="stylesheet" type="text/css" href="../../static/css/dataTable.css">
    <link rel="stylesheet" href="../../static/css/io_table_format.css" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../static/css/drop_down.css">
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="/home">Boletin BC</a>
          <div id ="navbar" class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="/">Inicio</a></li>
              <li><a href="/filteredSearch">Busqueda Judicial</a></li>
              <li><a href="/goToMyExpedientes">Mis Expedientes</a></li>
              <li><a href="/about">Acerca</a></li>
            </ul>
            <ul class="nav navbar-nav pull-right">
              <li>
                <form class="navbar-form pull-left" action="/showCase" method="post">
                  <input class="span2"    type="text"       name='inputCase'     placeholder="nombre / expediente" required>
                  <input type="hidden" name="formId" value="Keyword">
                  <button href="#signUp"  type="submit"     class="btn" >Buscar Expediente</button>
                </form>
              </li>
              <li class="nav-item dropdown">
                 <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                   Menu
                 </a>
                 <div class="dropdown-menu" aria-labelledby="navbarDropdown" style="background-color: black; color:white;">
                   <a class="dropdown-item" href="/profile" style="color: white; margin-left: 10px">Perfil</a>
                   <div class="dropdown-divider"></div>
                   <a class="dropdown-item" href="/config" style="color: white; margin-left: 10px">Configuracion</a>
                   <div class="dropdown-divider"></div>
                 </div>
               </li>
              <li><a href="/logout"><span class="glyphicon glyphicon-log-out"></span>Cerrar Sesion</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <!-- Main hero unit for a primary marketing message or call to action -->
      <div class="hero-unit" style="background-image: url(../../static/Uploads/geminis32_3.jpg);border-radius:3px;">
        <h1 style='font-weight: 100;      font-size: 40px;'>Bienvenido!</h1>
        <h1 style='font-weight: lighter;  font-size: 40px;'>{{username}}</h1>
        <h4 style='font-weight: lighter;  color:{{color}}'>{{notificaciones}} Nuevas resoluciones</h4>
        <p></p>
        <!-- <p><a class="btn btn-primary btn-large" href="/showSignUp">Sign Up!</a></p> -->
        <form class="navbar-form dropdown pull-left">
          <!-- <input id="novoexpediente" class="span2"    type="text"       placeholder="No. Expediente" style="vertical-align=bottom;" required> -->
          <!-- <input type='button' value='+ Nuevo Expediente' onclick='addCase(this)' style="font-size:10pt; vertical-align: bottom" class="btn-primary" ></input> -->

          <!-- <a role="button" data-toggle="dropdown" style="font-size:10pt; vertical-align: bottom;" class="btn btn-primary" data-target="#" href="/page.html"> + Nuevo Expediente <span class="caret"></span></a> -->
          <input id="novoexpediente" class="span2" type="text" placeholder="No. Expediente" style="vertical-align=bottom; width: 170px;" required>
            <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
              <li>
                <a tabindex="-1" href="#">Baja California</a>
                <ul class="dropdown-menu">
                  <li><a href="#">Tribunal Superior de Justicia</a></li>
                </ul>
              </li>
              <li>
                <a tabindex="-1" href="#">Tijuana</a>
                <ul class="dropdown-menu">
                  <li><a href="#">Primero Civil</a></li>
                  <li><a href="#">Segundo Civil</a></li>
                  <li><a href="#">Tercero Civil</a></li>
                  <li><a href="#">Cuarto Civil</a></li>
                  <li><a href="#">Quinto Civil</a></li>
                  <li><a href="#">Sexto Civil</a></li>
                  <li><a href="#">Septimo Civil</a></li>
                  <li><a href="#">Octavo Civil</a></li>
                  <li><a href="#">Noveno Civil</a></li>
                  <li><a href="#">Decimo Civil</a></li>
                  <li><a href="#">Decimo Primero Civil</a></li>
                  <li><a href="#">Primero Familiar</a></li>
                  <li><a href="#">Segundo Familiar</a></li>
                  <li><a href="#">Tercero Familiar</a></li>
                </ul>
              </li>
              <li>
                <a tabindex="-1" href="#">Mexicali</a>
                <ul class="dropdown-menu">
                  <li><a href="#">Primero Civil</a></li>
                  <li><a href="#">Segundo Civil</a></li>
                  <li><a href="#">Tercero Civil</a></li>
                  <li><a href="#">Cuarto Civil</a></li>
                  <li><a href="#">Quinto Civil</a></li>
                  <li><a href="#">Sexto Civil</a></li>
                  <li><a href="#">Septimo Civil</a></li>
                  <li><a href="#">Octavo Civil</a></li>
                  <li><a href="#">Primero Familiar</a></li>
                  <li><a href="#">Segundo Familiar</a></li>
                  <li><a href="#">Tercero Familiar</a></li>
                </ul>
              </li>
              <li>
                <a tabindex="-1" href="#">Ensenada</a>
                <ul class="dropdown-menu">
                  <li><a href="#">Primero Civil</a></li>
                  <li><a href="#">Segundo Civil</a></li>
                  <li><a href="#">Tercero Civil</a></li>
                  <li><a href="#">Cuarto Civil</a></li>
                  <li><a href="#">Primero Familiar</a></li>
                  <li><a href="#">Segundo Familiar</a></li>
                </ul>
              </li>
              <li>
                <a tabindex="-1" href="#">Tecate</a>
                <ul class="dropdown-menu">
                  <li><a href="#">Primero Civil</a></li>
                </ul>
              </li>
              <li>
                <a tabindex="-1" href="#">Juzgados Mixtos</a>
                <ul class="dropdown-menu">
                  <li><a href="#">San Felipe</a></li>
                  <li><a href="#">Ciudad Morelos</a></li>
                  <li><a href="#">San Quintin</a></li>
                  <li><a href="#">Playas de Rosarito</a></li>
                  <li><a href="#">Ciudad Guadalupe Victoria</a></li>
                </ul>
              </li>
            </ul>


            <a role="button" data-toggle="dropdown" style="font-size:10pt; vertical-align: bottom; width:144px;" class="btn btn-primary" data-target="#" href="/page.html"> + Nuevo Expediente
              <span class="caret"></span></a>

          </form>
          <p></p>

        </div>

      </div>
    </div>
    <div class="container">
      <div class="hero-unit" align='center' style="border-radius= 3px;">
        <!-- <div class="table-responsive"> -->
        <table class="table-responsive table-striped table-inverse table-hover" align="center"   style="width: 80%; "name="tabla">
          <caption >
            <h1 class="row title" style='font-weight: lighter; color:black; font-size: 30px;'>Ultimas Resoluciones:</h1>
          </caption>
          <thead>
              <tr style='font-size: 15px;'>
                  <th scope="col">CIUDAD</th>
                  <th scope="col">JUZGADO</th>
                  <th scope="col">EXPEDIENTE</th>
                  <th scope="col">ULTIMA ACTIVIDAD</th>
                  <th scope="col"></th>
              </tr>
          </thead>
          <tbody>
              {% for row in data %}
                {% if notificaciones != "0" %}
                  <tr id ="{{row[1]}}">
                  {% for d in row %}
                    <td >{{ d }}</td>
                  {% endfor %}
                {% endif %}
              {% endfor %}
          </tbody>
        </table>
        <!-- </div> -->
      </div>

      <div class="hero-unit" align="center" style="border-radius= 3px;">
        <div class="table-responsive">
        <table  id="table_id" class="table table-striped table-inverse table-hover"   style="width: 80%;" >
          <caption >
            <h1 class="row title" style='font-weight: lighter; color:black; font-size: 30px;'>Mis Expedientes:</h1>
          </caption>
          <thead>
              <tr style='font-size: 15px;' >
                  <th scope="col">CIUDAD</th>
                  <th scope="col">JUZGADO</th>
                  <th scope="col">EXPEDIENTE</th>
                  <th scope="col">ULTIMA ACTIVIDAD</th>
                  <th scope="col"></th>
              </tr>
          </thead>
          <tbody >

              {% for row in data %}
                  <tr id ="{{row[1]}}" >
                  {% for d in row %}
                       <td scope   ="col"
                           onclick = "detalle(this, '{{row[2]}}', '{{row[1]}}')">
                         {{ d }}
                       </td>
                  {% endfor %}

                  <td>
                      <center>
                        <button class   ="btn"
                              onclick = "deleteCase(this, '{{row[2]}}', '{{row[0]}}', '{{row[1]}}','{{row[1]}}')">
                              <i class="fa fa-trash"> </i>
                        </button>
                      </center>
                  </td>

                  </tr>
              {% endfor %}
          </tbody>
        </table>
        </div>
      </div>
    </div>

    <footer style="margin-top:80px ; margin-left: 80px">
        <h5 class="brand" >&copy; IO Patterns 2017</h5>
    </footer>
    <!-- ===================================== Le javascript =========================== -->
    <!-- Placed at the end of the document so the pages load faster-->
    <script src="../../static/assets/js/jquery.js"></script>
    <script src="../../static/assets/js/bootstrap-transition.js"></script>
    <script src="../../static/assets/js/bootstrap-collapse.js"></script>
    <script src="../../static/assets/js/bootstrap-alert.js"></script>
    <script src="../../static/assets/js/bootstrap-modal.js"></script>
    <script src="../../static/assets/js/bootstrap-dropdown.js"></script>
    <script src="../../static/assets/js/bootstrap-scrollspy.js"></script>
    <script src="../../static/assets/js/bootstrap-tab.js"></script>
    <script src="../../static/assets/js/bootstrap-tooltip.js"></script>
    <script src="../../static/assets/js/bootstrap-popover.js"></script>
    <script src="../../static/assets/js/bootstrap-button.js"></script>
    <script src="../../static/assets/js/bootstrap-collapse.js"></script>
    <script src="../../static/assets/js/bootstrap-carousel.js"></script>
    <script src="../../static/assets/js/bootstrap-typeahead.js"></script>
    <script src="../../static/js/jquery.dataTables.js"></script>
    <!-- To debbug upgrade for jquery-->
    <script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>


    <script>

      // first script is for table sorting
      $(document).ready( function () {
        $('#table_id').DataTable();
      } );


      /*  THIS BLOCK IS FOR DROPDOWN - PENDING TO CLEAN */
      $(".dropdown-menu a").click(function (event)
        {
          event.preventDefault();
          event.stopPropagation();
          $(this).parent().siblings().removeClass('open');
          $(this).parent().toggleClass('open');
          var ciudad = $(this).text();
          if (ciudad == "Tijuana" || ciudad == "Mexicali" || ciudad == "Ensenada" ||
              ciudad == "Tecate"  || ciudad == "Juzgados Mixtos" || ciudad == "Baja California")
          {
            getCity($(this).text());
          }
          else
          {
            var exp = document.getElementById("novoexpediente");
            var jury = ciudad;
            var ret = addCase(getCity.city, jury, exp);
            if (ret)
            {
              alert( "Monitoreando Nuevo Expediente: " + exp.value + " en " + getCity.city + " " + $(this).text() );
              window.location = '/';
            }
          }


        });
      // Close the dropdown menu if the user clicks outside of it
      window.onclick = function(event)
        {
          if (!event.target.matches('.dropbtn'))
            {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++)
              {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show'))
                {
                openDropdown.classList.remove('show');
                }
              }
            }
        }
      function getCity(s)
        {
          getCity.city = s;
        }
      getCity.city = 'None';
      /* END OF DROPDOWN FUNCTIONS */
      function isLetter(s)
        {
          return s.match(/[a-z]/i);
        }
      function isSlash(s)
        {
          // Aqui me gustaria algun dia poder saber inteligentemente en que folios van los casos y evitar errores
          // al querer meter un caso como 9988/99 sin que aun exista pero sea formato y rango validio, creo que
          // haciendo esto salvaremos posibles querys innecesarios a la base de datos == a -dinero que pagarle a gogel.
          return s.match(/^([0-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9][0-9])[- /.][0-9]?[0-9]?[0-9]?[0-9]$/);
        }
      function addCase(city, jury, link)
        {
          exp = link.value;
          //alert(exp);
          // Check if string empty, or if lenght is less than 4 or more than 9 chars.
          if (exp == "" || (exp.length<4 || exp.length>9) || isLetter(exp) )
          {
            alert("No. de Expediente requerido. Seguir formato: folio/año -> 123456/17");
            return false;
          }
          if (!isSlash(exp))
          {
            alert("No. de Expediente requerido. Seguir formato: folio/año -> 123456/17");
            return false;
          }
          if (city == "Juzgados Mixtos")
          {
            city = jury
            jury = "Mixto"
          }
          // Maybe here we need to validate even more, check the complete format, the '/'
          // before the 2 digit year.
          //console.log(expediente);
          $.post(
              "/addCase",

              {  ciudad : city,
                 juzgado : jury,
                 expediente : exp,
                 contenido: 0 } ) ;

          return true;
        }
      function detalle(link, expediente, juzgado)
         {
          // Obtain the row where the current <a> is and remove it
            var row = link.parentNode.parentNode;
            var table = row.parentNode;
            var path = '/detailcase?personal=1&fromAndroid=0&inputCase=';
            path = path.concat(String(expediente));
            path = path.concat('&jury=');
            path = path.concat(String(juzgado));
            console.log(path)
            window.location = path;
            // TODO: construct this request in a better way, not a hardcoded string for arguments
            // $.get(
            //   path ) ;
         }

      function deleteCase(link, expediente, ciudad, juzgado, ramo)
        {
          var ask = confirm("¿Estas seguro de dejar de seguir este expediente?");

          if (ask)
          {
            $.post(
              "/removeCase",
              {  file : expediente,
                 city : ciudad,
                 jury : juzgado,
                 field : ramo } )

              .done(function(data) {
                alert(data);
                window.location = '/';
            });
          }
        }


      function removeMSQL(link, expediente, juzgado)
         {
          // Obtain the row where the current <a> is and remove it
            var row = link.parentNode.parentNode;
            var table = row.parentNode;
            table.removeChild(row);
            $.post(
              "/removeCase",
              {  case     : expediente,
                 juzgado  : juzgado  } ) ;
         }
    </script>
  </body>
</html>
</html>
